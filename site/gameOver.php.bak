<!Doctype html>

<html>
    <head>
        <meta charset="ISO-8859-1">
        <title>Game Over</title>
        <link rel="stylesheet" type="text/css" href="/3/Styles/eintragen.css">
    </head>

    <body>
        <?php
            @$score = $_POST['dauer'];
            
            if(isset($score) && !$score == 0):
                $visible = "visible";
            else:
                $visible = "none";
                $score = "Bitte erst spielen";
            endif;
        ?>

        <div id="divname">
            <img src="/3/Images/name.png" alt="name_schrift">
        </div>
        <div id="divscore">
            <img src="/3/Images/score.png" alt="score_schrift">
        </div>
        <form action="" method="post">
            <input id='divtextfeldn' type="text" name="Username" maxlength='15' placeholder="Bitte Name Eintragen"/>
          
            <input id='divtextfelds' readonly="readonly" type="text" name="score" value="<?php echo $score; ?>" />

            <button id='buttoneintragen' type="submit" style="display:<?php echo$visible?>"  name="submit"><img src="/3/Images/abschicken.png"></button> <!--onclick="onClickAbsenden()"-->
        </form>
        <div id='divcon'>
            <a href="/3/site/scoreboard.php"><img src="/3/Images/scoreboard.png" alt="continue_schrift"></a>
        </div>

        <?php    
        if(isset($_POST['submit'])):
            onClick();
        endif;
            
        function onClick(){            
            $Username = $_POST['Username'];
            $score = $_POST['score'];
            
            if($Username=="Bitte Name Eintragen"){
				alert("Bitte Namen eintragen");
			}else{
                $connection = connectDB();
                writeDB($connection, $Username, $score);    
            }
        }
        
        function writeDB($pDB, $pUname, $pScore){
            $absenden = $pDB -> prepare("INSERT INTO scoreboard_daten (Name,Punkte) VALUES(?,?)");
            $absenden->bind_param('ss', $pUname, $pScore);
            $absenden->execute();
            $pDB->close();
            header('Location: /3/site/scoreboard.php');
        }
        
        function connectDB(){
            //$db = new mysqli('rimikis.de', 'UnicornWars','6YexQCE224idrSvn','UnicornWars',3306);
            $db = new mysqli('localhost', 'admin','admin','scoreboard');

            if(!$db):
                alert("Keine verbindung zur DB");
            endif;
			
            return $db;
        }
        
        function alert($message) {
            echo "<script type='text/javascript'>alert('$message');</script>";
        }
        ?>
    </body>
</html>
